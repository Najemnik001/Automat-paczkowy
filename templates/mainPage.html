<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Strona Główna</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Witaj, {{ user.username }}!</h1>

    <!-- Przycisk do wylogowania -->
    <form action="{% url 'logout' %}" method="post">
        {% csrf_token %}
        <button type="submit">Wyloguj się</button>
    </form>

    <h2>Paczki, które są nadane do Ciebie:</h2>
    {% if received_parcels %}
        <ul>
            {% for parcel in received_parcels %}
                <li>
                    {{ parcel.name }} - {{ parcel.status }} - Rozmiar: {{ parcel.get_size_display }}
                    {% if parcel.delivered_at %}
                        - Dostarczona dnia {{ parcel.delivered_at }}
                    {% endif %}
                    {% if parcel.courier_number %}
                        - Kurier: {{ parcel.courier_number }}
                    {% endif %}
                    {% if parcel.sent_to_machine %}
                        - Paczkomat odbiorczy: {{ parcel.sent_to_machine.name }} ({{ parcel.sent_to_machine.location }})
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Nie masz paczek jadących do Ciebie.</p>
    {% endif %}

    <h2>Twoje wysłane paczki:</h2>
    {% if sent_parcels %}
        <ul>
            {% for parcel in sent_parcels %}
                <li>
                    {{ parcel.name }} - {{ parcel.status }} - Rozmiar: {{ parcel.get_size_display }}
                    {% if parcel.delivered_at %}
                        - Dostarczona dnia {{ parcel.delivered_at }}
                    {% endif %}
                    {% if parcel.courier_number %}
                        - Kurier: {{ parcel.courier_number }}
                    {% endif %}
                    {% if parcel.sent_from_machine %}
                        - Paczkomat nadawczy: {{ parcel.sent_from_machine.name }} ({{ parcel.sent_from_machine.location }})
                    {% endif %}
                    
                    {% if parcel.status == 'shipment_ordered' %}
                        <!-- Przyciski do zmiany statusu na 'stored_in_machine' -->
                        <button class="store_in_machine" data-parcel-id="{{ parcel.id }}">Przekaż paczkę do paczkomatu</button>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Nie masz wysłanych paczek.</p>
    {% endif %}

    <!-- Przycisk do nadania paczki -->
    <a href="{% url 'create_parcel' %}">
        <button>Przejdź do nadawania paczki</button>
    </a>

    <script>
        $(document).ready(function(){
            $(".store_in_machine").click(function(){
                var parcelId = $(this).data('parcel-id');
                alert("Umieść paczkę w automacie");
                // Wyślij zapytanie AJAX do serwera
                $.ajax({
                    
                    url: "{% url 'mock_store_parcel' %}",
                    type: "POST",
                    data: {
                        'parcel_id': parcelId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        alert("Paczka została umieszczona w skrytce!");
                            location.reload();
                    },
                    error: function() {
                        alert("Wystąpił problem podczas procesu.");
                    }
                });
            });
        });
    </script>

</body>
</html>
